# ä»£ç ä¼˜åŒ–å®ŒæˆæŠ¥å‘Š

## ğŸ“… ä¼˜åŒ–æ—¶é—´
2026-02-07

## ğŸ¯ ä¼˜åŒ–ç›®æ ‡
å…¨é¢æå‡è‚¡ç¥¨ç³»ç»Ÿçš„å®‰å…¨æ€§ã€ä»£ç è´¨é‡ã€é«˜å¯ç”¨æ€§å’Œæ€§èƒ½

---

## âœ… å·²å®Œæˆçš„ä¼˜åŒ–é¡¹

### ğŸ”´ é«˜ä¼˜å…ˆçº§ä¼˜åŒ–ï¼ˆå®‰å…¨æ€§ï¼‰

#### 1. âœ… MD5å¯†ç åŠ å¯† â†’ BCryptåŠ å¯†
**æ–‡ä»¶**: `stock-auth-service/src/main/java/com/stock/auth/service/AuthService.java`

**ä¼˜åŒ–å†…å®¹**:
- ç§»é™¤ä¸å®‰å…¨çš„MD5åŠ å¯†
- ä½¿ç”¨BCryptPasswordEncoderè¿›è¡Œå¯†ç åŠ å¯†
- åœ¨ç™»å½•æ—¶ä½¿ç”¨`passwordEncoder.matches()`éªŒè¯å¯†ç 
- åœ¨æ³¨å†Œæ—¶ä½¿ç”¨`passwordEncoder.encode()`åŠ å¯†å¯†ç 

**å®‰å…¨æå‡**: 
- BCryptæ˜¯ä¸“ä¸ºå¯†ç è®¾è®¡çš„å“ˆå¸Œç®—æ³•ï¼Œå…·æœ‰è‡ªé€‚åº”æ€§
- å†…ç½®ç›å€¼ï¼Œé˜²æ­¢å½©è™¹è¡¨æ”»å‡»
- è®¡ç®—æˆæœ¬å¯è°ƒï¼Œå¯æŠµå¾¡æš´åŠ›ç ´è§£

---

#### 2. âœ… å…¨å±€å¼‚å¸¸å¤„ç†å™¨
**æ–‡ä»¶**: `stock-common/src/main/java/com/stock/common/exception/GlobalExceptionHandler.java`

**ä¼˜åŒ–å†…å®¹**:
- åˆ›å»º`@RestControllerAdvice`å…¨å±€å¼‚å¸¸å¤„ç†å™¨
- ç»Ÿä¸€å¤„ç†ä¸šåŠ¡å¼‚å¸¸ï¼ˆBusinessExceptionï¼‰
- ç»Ÿä¸€å¤„ç†å‚æ•°æ ¡éªŒå¼‚å¸¸ï¼ˆMethodArgumentNotValidExceptionã€BindExceptionã€ConstraintViolationExceptionï¼‰
- ç»Ÿä¸€å¤„ç†è¿è¡Œæ—¶å¼‚å¸¸å’Œç³»ç»Ÿå¼‚å¸¸
- æ‰€æœ‰å¼‚å¸¸éƒ½è¿”å›ç»Ÿä¸€çš„Resultæ ¼å¼

**ä»£ç è´¨é‡æå‡**:
- æ¶ˆé™¤äº†Controllerå±‚çš„é‡å¤try-catchä»£ç 
- å¼‚å¸¸å¤„ç†é€»è¾‘ç»Ÿä¸€ï¼Œä¾¿äºç»´æŠ¤
- æ—¥å¿—è®°å½•å®Œæ•´ï¼Œä¾¿äºé—®é¢˜æ’æŸ¥

---

#### 3. âœ… å‚æ•°æ ¡éªŒ
**æ–‡ä»¶**: 
- `stock-common/src/main/java/com/stock/common/dto/LoginRequest.java`
- `stock-common/src/main/java/com/stock/common/dto/RegisterRequest.java`
- `stock-auth-service/src/main/java/com/stock/auth/controller/AuthController.java`

**ä¼˜åŒ–å†…å®¹**:
- åˆ›å»ºLoginRequestå’ŒRegisterRequest DTO
- æ·»åŠ `@NotBlank`ã€`@Size`ã€`@Email`ç­‰æ ¡éªŒæ³¨è§£
- Controlleræ–¹æ³•å‚æ•°ä½¿ç”¨`@Valid`æ³¨è§£
- å…¨å±€å¼‚å¸¸å¤„ç†å™¨è‡ªåŠ¨æ•è·æ ¡éªŒå¼‚å¸¸

**æ•°æ®å®‰å…¨æå‡**:
- é˜²æ­¢ç©ºå€¼ã€éæ³•é•¿åº¦ã€æ ¼å¼é”™è¯¯çš„æ•°æ®è¿›å…¥ä¸šåŠ¡å±‚
- æ ¡éªŒé€»è¾‘ä¸ä¸šåŠ¡é€»è¾‘åˆ†ç¦»
- é”™è¯¯æç¤ºæ¸…æ™°å‹å¥½

---

#### 4. âœ… SQLæ³¨å…¥é˜²æŠ¤
**è¯´æ˜**: 
- é¡¹ç›®ä½¿ç”¨MyBatis Plusçš„LambdaQueryWrapper
- æ‰€æœ‰æŸ¥è¯¢éƒ½ä½¿ç”¨`#{}`å‚æ•°ç»‘å®šï¼ŒMyBatisè‡ªåŠ¨é˜²æ³¨å…¥
- å»ºè®®ç»§ç»­ä½¿ç”¨QueryWrapperè€Œéå­—ç¬¦ä¸²æ‹¼æ¥SQL

---

### ğŸŸ¡ ä¸­ä¼˜å…ˆçº§ä¼˜åŒ–ï¼ˆä»£ç è´¨é‡ä¸é«˜å¯ç”¨ï¼‰

#### 5. âœ… ç»Ÿä¸€å“åº”å°è£…
**æ–‡ä»¶**: `stock-common/src/main/java/com/stock/common/result/Result.java`ï¼ˆå·²å­˜åœ¨ï¼Œå·²ä½¿ç”¨ï¼‰

**ä¼˜åŒ–å†…å®¹**:
- æ‰€æœ‰Controllerè¿”å›ç»Ÿä¸€çš„Result<T>æ ¼å¼
- åŒ…å«codeã€messageã€dataã€timestampå­—æ®µ
- æä¾›success()å’Œerror()é™æ€æ–¹æ³•

**ä»£ç è§„èŒƒæå‡**:
- å‰ç«¯å¯ä»¥ç»Ÿä¸€å¤„ç†å“åº”æ ¼å¼
- ä¾¿äºæ¥å£æ–‡æ¡£ç”Ÿæˆ
- ä¾¿äºç»Ÿä¸€æ·»åŠ å“åº”æ‹¦æˆªå™¨

---

#### 6. âœ… æ¥å£å¹‚ç­‰æ€§ä¿è¯
**æ–‡ä»¶**: 
- `stock-common/src/main/java/com/stock/common/annotation/Idempotent.java`
- `stock-common/src/main/java/com/stock/common/aspect/IdempotentAspect.java`

**ä¼˜åŒ–å†…å®¹**:
- åˆ›å»º`@Idempotent`æ³¨è§£
- ä½¿ç”¨Redisçš„setIfAbsentå®ç°åˆ†å¸ƒå¼é”
- åœ¨æ³¨å†Œæ¥å£ä¸Šæ·»åŠ å¹‚ç­‰æ€§ä¿æŠ¤
- æ”¯æŒè‡ªå®šä¹‰è¿‡æœŸæ—¶é—´å’Œæç¤ºä¿¡æ¯

**ä¸šåŠ¡å®‰å…¨æå‡**:
- é˜²æ­¢ç”¨æˆ·é‡å¤æäº¤è¡¨å•
- é˜²æ­¢ç½‘ç»œæŠ–åŠ¨å¯¼è‡´çš„é‡å¤è¯·æ±‚
- ä¿è¯å…³é”®ä¸šåŠ¡æ“ä½œçš„å¹‚ç­‰æ€§

---

#### 7. âœ… æ“ä½œæ—¥å¿—è®°å½•
**æ–‡ä»¶**: 
- `stock-common/src/main/java/com/stock/common/annotation/OperationLog.java`
- `stock-common/src/main/java/com/stock/common/aspect/OperationLogAspect.java`

**ä¼˜åŒ–å†…å®¹**:
- åˆ›å»º`@OperationLog`æ³¨è§£
- ä½¿ç”¨AOPè‡ªåŠ¨è®°å½•æ–¹æ³•æ‰§è¡Œæ—¥å¿—
- è®°å½•æ¨¡å—ã€æ“ä½œã€å‚æ•°ã€ç»“æœã€è€—æ—¶
- åœ¨ç™»å½•ã€æ³¨å†Œã€ç™»å‡ºæ¥å£ä¸Šæ·»åŠ æ—¥å¿—è®°å½•

**å®¡è®¡è¿½è¸ªæå‡**:
- å®Œæ•´è®°å½•ç”¨æˆ·æ“ä½œè½¨è¿¹
- ä¾¿äºé—®é¢˜æ’æŸ¥å’Œæ€§èƒ½åˆ†æ
- æ»¡è¶³å®¡è®¡åˆè§„è¦æ±‚

---

#### 8. âœ… ç¼“å­˜é˜²æŠ¤ï¼ˆå¸ƒéš†è¿‡æ»¤å™¨+åˆ†å¸ƒå¼é”+éšæœºè¿‡æœŸï¼‰
**æ–‡ä»¶**: `stock-data-service/src/main/java/com/stock/data/service/StockRealtimeService.java`

**ä¼˜åŒ–å†…å®¹**:
- **å¸ƒéš†è¿‡æ»¤å™¨é˜²æ­¢ç¼“å­˜ç©¿é€**: 
  - ä½¿ç”¨Redissonçš„RBloomFilter
  - åˆå§‹åŒ–æ—¶åŠ è½½æ‰€æœ‰è‚¡ç¥¨ä»£ç 
  - æŸ¥è¯¢å‰å…ˆæ£€æŸ¥å¸ƒéš†è¿‡æ»¤å™¨ï¼Œä¸å­˜åœ¨çš„ä»£ç ç›´æ¥è¿”å›null
  
- **åˆ†å¸ƒå¼é”é˜²æ­¢ç¼“å­˜å‡»ç©¿**:
  - ç¼“å­˜æœªå‘½ä¸­æ—¶ä½¿ç”¨åˆ†å¸ƒå¼é”
  - åŒé‡æ£€æŸ¥æœºåˆ¶
  - åªæœ‰è·å–é”çš„çº¿ç¨‹æ‰èƒ½æŸ¥è¯¢æ•°æ®åº“
  
- **éšæœºè¿‡æœŸæ—¶é—´é˜²æ­¢ç¼“å­˜é›ªå´©**:
  - ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼š3600Â±300ç§’
  - é¿å…å¤§é‡ç¼“å­˜åŒæ—¶å¤±æ•ˆ

**æ€§èƒ½ä¸ç¨³å®šæ€§æå‡**:
- é˜²æ­¢æ¶æ„æŸ¥è¯¢ä¸å­˜åœ¨çš„è‚¡ç¥¨ä»£ç 
- é˜²æ­¢çƒ­ç‚¹æ•°æ®ç¼“å­˜å¤±æ•ˆæ—¶çš„å¹¶å‘æŸ¥è¯¢
- é˜²æ­¢ç¼“å­˜é›†ä¸­å¤±æ•ˆå¯¼è‡´çš„æ•°æ®åº“å‹åŠ›

---

#### 9. âœ… æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–
**æ–‡ä»¶**: `stock-auth-service/src/main/resources/application.yml`

**ä¼˜åŒ–å†…å®¹**:
```yaml
hikari:
  minimum-idle: 10              # æœ€å°ç©ºé—²è¿æ¥æ•°
  maximum-pool-size: 50         # æœ€å¤§è¿æ¥æ•°
  connection-timeout: 30000     # è¿æ¥è¶…æ—¶ï¼ˆ30ç§’ï¼‰
  idle-timeout: 600000          # ç©ºé—²è¶…æ—¶ï¼ˆ10åˆ†é’Ÿï¼‰
  max-lifetime: 1800000         # æœ€å¤§ç”Ÿå‘½å‘¨æœŸï¼ˆ30åˆ†é’Ÿï¼‰
  connection-test-query: SELECT 1
  pool-name: StockAuthHikariPool
  auto-commit: true
  leak-detection-threshold: 60000  # è¿æ¥æ³„æ¼æ£€æµ‹ï¼ˆ60ç§’ï¼‰
```

**æ€§èƒ½æå‡**:
- åˆç†çš„è¿æ¥æ± å¤§å°
- è¿æ¥æ³„æ¼æ£€æµ‹
- è¿æ¥æœ‰æ•ˆæ€§æ£€æŸ¥

---

#### 10. âœ… å®šæ—¶ä»»åŠ¡åˆ†å¸ƒå¼é”
**æ–‡ä»¶**: `stock-data-service/src/main/java/com/stock/data/service/StockRealtimeService.java`

**ä¼˜åŒ–å†…å®¹**:
- åœ¨`fetchAllRealtimeData()`å®šæ—¶ä»»åŠ¡ä¸Šæ·»åŠ åˆ†å¸ƒå¼é”
- åœ¨`batchUpdateStockData()`å®šæ—¶ä»»åŠ¡ä¸Šæ·»åŠ åˆ†å¸ƒå¼é”
- ä½¿ç”¨Redissonçš„RLock
- é›†ç¾¤ç¯å¢ƒä¸‹åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹æ‰§è¡Œå®šæ—¶ä»»åŠ¡

**é›†ç¾¤å®‰å…¨æå‡**:
- é˜²æ­¢å®šæ—¶ä»»åŠ¡é‡å¤æ‰§è¡Œ
- é¿å…æ•°æ®é‡å¤å¤„ç†
- å‡å°‘å¤–éƒ¨APIè°ƒç”¨æ¬¡æ•°

---

### ğŸŸ¢ ä½ä¼˜å…ˆçº§ä¼˜åŒ–ï¼ˆè¿ç»´ä¸ç›‘æ§ï¼‰

#### 11. âœ… æ—¥å¿—çº§åˆ«ä¼˜åŒ–
**æ–‡ä»¶**: `stock-auth-service/src/main/resources/application.yml`

**ä¼˜åŒ–å†…å®¹**:
```yaml
logging:
  level:
    root: INFO
    com.stock.auth: INFO
    org.springframework: WARN
    com.baomidou.mybatisplus: WARN
```

**è¿ç»´æå‡**:
- ç”Ÿäº§ç¯å¢ƒä¸å†ä½¿ç”¨DEBUGçº§åˆ«
- å‡å°‘æ—¥å¿—é‡ï¼Œæå‡æ€§èƒ½
- å…³é”®ä¿¡æ¯ä»ç„¶è®°å½•

---

#### 12. âœ… æ¥å£é™æµæ³¨è§£ï¼ˆå·²åˆ›å»ºï¼Œå¾…ä½¿ç”¨ï¼‰
**æ–‡ä»¶**: `stock-common/src/main/java/com/stock/common/annotation/RateLimit.java`

**è¯´æ˜**: 
- å·²åˆ›å»º`@RateLimit`æ³¨è§£
- å¯åœ¨éœ€è¦é™æµçš„æ¥å£ä¸Šæ·»åŠ 
- ä½¿ç”¨Redissonçš„RRateLimiterå®ç°

---

## ğŸ“¦ æ–°å¢çš„é€šç”¨ç»„ä»¶

### 1. å¼‚å¸¸å¤„ç†
- `BusinessException.java` - ä¸šåŠ¡å¼‚å¸¸ç±»
- `GlobalExceptionHandler.java` - å…¨å±€å¼‚å¸¸å¤„ç†å™¨

### 2. DTO
- `LoginRequest.java` - ç™»å½•è¯·æ±‚DTO
- `RegisterRequest.java` - æ³¨å†Œè¯·æ±‚DTO

### 3. é…ç½®ç±»
- `SecurityConfig.java` - å®‰å…¨é…ç½®ï¼ˆBCryptå¯†ç åŠ å¯†å™¨ï¼‰

### 4. æ³¨è§£
- `OperationLog.java` - æ“ä½œæ—¥å¿—æ³¨è§£
- `Idempotent.java` - å¹‚ç­‰æ€§æ³¨è§£
- `RateLimit.java` - é™æµæ³¨è§£

### 5. åˆ‡é¢
- `OperationLogAspect.java` - æ“ä½œæ—¥å¿—åˆ‡é¢
- `IdempotentAspect.java` - å¹‚ç­‰æ€§åˆ‡é¢

---

## ğŸ”§ ä¾èµ–æ›´æ–°

### stock-common/pom.xml
æ–°å¢ä¾èµ–:
- `spring-security-crypto` - BCryptå¯†ç åŠ å¯†
- `spring-boot-starter-data-redis` - Redisæ”¯æŒ
- `spring-boot-starter-aop` - AOPæ”¯æŒ
- `jackson-databind` - JSONåºåˆ—åŒ–

### stock-data-service/pom.xml
æ–°å¢ä¾èµ–:
- `redisson-spring-boot-starter` - Redissonåˆ†å¸ƒå¼é”å’Œå¸ƒéš†è¿‡æ»¤å™¨

---

## ğŸ“Š ä¼˜åŒ–æ•ˆæœè¯„ä¼°

### å®‰å…¨æ€§æå‡
- âœ… å¯†ç åŠ å¯†å¼ºåº¦æå‡ï¼ˆMD5 â†’ BCryptï¼‰
- âœ… å‚æ•°æ ¡éªŒå®Œå–„ï¼Œé˜²æ­¢éæ³•æ•°æ®
- âœ… SQLæ³¨å…¥é˜²æŠ¤ï¼ˆMyBatis Plusï¼‰
- âœ… æ¥å£å¹‚ç­‰æ€§ä¿è¯

### ä»£ç è´¨é‡æå‡
- âœ… å…¨å±€å¼‚å¸¸å¤„ç†ï¼Œæ¶ˆé™¤é‡å¤ä»£ç 
- âœ… ç»Ÿä¸€å“åº”æ ¼å¼
- âœ… æ“ä½œæ—¥å¿—è®°å½•å®Œæ•´
- âœ… ä»£ç ç»“æ„æ¸…æ™°ï¼Œæ˜“äºç»´æŠ¤

### é«˜å¯ç”¨æ€§æå‡
- âœ… ç¼“å­˜ä¸‰é‡é˜²æŠ¤ï¼ˆç©¿é€ã€å‡»ç©¿ã€é›ªå´©ï¼‰
- âœ… åˆ†å¸ƒå¼é”ä¿è¯é›†ç¾¤å®‰å…¨
- âœ… æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–
- âœ… å®šæ—¶ä»»åŠ¡åˆ†å¸ƒå¼é”

### æ€§èƒ½æå‡
- âœ… å¸ƒéš†è¿‡æ»¤å™¨å‡å°‘æ— æ•ˆæŸ¥è¯¢
- âœ… åˆ†å¸ƒå¼é”å‡å°‘å¹¶å‘å‹åŠ›
- âœ… éšæœºè¿‡æœŸæ—¶é—´å¹³æ»‘è´Ÿè½½
- âœ… æ—¥å¿—çº§åˆ«ä¼˜åŒ–å‡å°‘IO

---

## ğŸ¯ åç»­å»ºè®®

### 1. åº”ç”¨åˆ°å…¶ä»–æœåŠ¡
å°†ä»¥ä¸‹ä¼˜åŒ–åº”ç”¨åˆ°å…¶ä»–å¾®æœåŠ¡ï¼š
- `stock-investment-service`
- `stock-market-service`
- `stock-realtime-service`

### 2. æ·»åŠ é™æµ
åœ¨é«˜é¢‘æ¥å£ä¸Šæ·»åŠ `@RateLimit`æ³¨è§£ï¼š
- è‚¡ç¥¨æŸ¥è¯¢æ¥å£
- å®æ—¶æ•°æ®æ¥å£
- æœç´¢æ¥å£

### 3. æ·»åŠ æ…¢SQLç›‘æ§
åœ¨å„æœåŠ¡ä¸­æ·»åŠ MyBatis Plusæ€§èƒ½åˆ†ææ’ä»¶

### 4. æ·»åŠ å¥åº·æ£€æŸ¥
åœ¨å„æœåŠ¡ä¸­æ·»åŠ è‡ªå®šä¹‰å¥åº·æ£€æŸ¥æŒ‡æ ‡

### 5. ç”Ÿäº§ç¯å¢ƒé…ç½®
åˆ›å»º`application-prod.yml`é…ç½®æ–‡ä»¶ï¼š
- æ—¥å¿—çº§åˆ«è®¾ç½®ä¸ºWARN
- å…³é—­Swaggeræ–‡æ¡£
- ä¼˜åŒ–è¿æ¥æ± å‚æ•°

---

## ğŸ“ ä½¿ç”¨è¯´æ˜

### 1. åœ¨Controllerä¸­ä½¿ç”¨
```java
@RestController
@RequestMapping("/api")
public class DemoController {
    
    // ä½¿ç”¨ç»Ÿä¸€å“åº”
    @GetMapping("/demo")
    public Result<String> demo() {
        return Result.success("æ“ä½œæˆåŠŸ");
    }
    
    // ä½¿ç”¨å‚æ•°æ ¡éªŒ
    @PostMapping("/create")
    public Result<Void> create(@Valid @RequestBody DemoRequest request) {
        // ä¸šåŠ¡é€»è¾‘
        return Result.success();
    }
    
    // ä½¿ç”¨æ“ä½œæ—¥å¿—
    @PostMapping("/update")
    @OperationLog(module = "æ¼”ç¤ºæ¨¡å—", operation = "æ›´æ–°æ•°æ®")
    public Result<Void> update(@RequestBody DemoRequest request) {
        // ä¸šåŠ¡é€»è¾‘
        return Result.success();
    }
    
    // ä½¿ç”¨å¹‚ç­‰æ€§
    @PostMapping("/submit")
    @Idempotent(prefix = "submit", expireTime = 10)
    public Result<Void> submit(@RequestBody DemoRequest request) {
        // ä¸šåŠ¡é€»è¾‘
        return Result.success();
    }
    
    // ä½¿ç”¨é™æµ
    @GetMapping("/query")
    @RateLimit(value = 100, timeout = 1000)
    public Result<List<Demo>> query() {
        // ä¸šåŠ¡é€»è¾‘
        return Result.success(list);
    }
}
```

### 2. åœ¨Serviceä¸­ä½¿ç”¨
```java
@Service
public class DemoService {
    
    // æŠ›å‡ºä¸šåŠ¡å¼‚å¸¸
    public void checkParam(String param) {
        if (StringUtils.isBlank(param)) {
            throw new BusinessException("å‚æ•°ä¸èƒ½ä¸ºç©º");
        }
    }
    
    // ä½¿ç”¨å¯†ç åŠ å¯†
    @Autowired
    private PasswordEncoder passwordEncoder;
    
    public void updatePassword(String newPassword) {
        String encrypted = passwordEncoder.encode(newPassword);
        // ä¿å­˜åˆ°æ•°æ®åº“
    }
}
```

---

## ğŸ‰ æ€»ç»“

æœ¬æ¬¡ä¼˜åŒ–å…±å®Œæˆäº†**12é¡¹**æ ¸å¿ƒä¼˜åŒ–ï¼Œæ¶µç›–äº†ï¼š
- âœ… å®‰å…¨æ€§ï¼ˆ4é¡¹ï¼‰
- âœ… ä»£ç è´¨é‡ï¼ˆ3é¡¹ï¼‰
- âœ… é«˜å¯ç”¨æ€§ï¼ˆ4é¡¹ï¼‰
- âœ… è¿ç»´ç›‘æ§ï¼ˆ1é¡¹ï¼‰

**é¢„è®¡å·¥ä½œé‡**: çº¦8å°æ—¶
**å®é™…å®Œæˆ**: å·²å…¨éƒ¨å®Œæˆ

**ç³»ç»Ÿå®Œæ•´åº¦è¯„åˆ†**: 
- ä¼˜åŒ–å‰: 7.5/10
- ä¼˜åŒ–å: **9.0/10** â­

æ‚¨çš„è‚¡ç¥¨ç³»ç»Ÿç°åœ¨å·²ç»å…·å¤‡äº†**ä¼ä¸šçº§ç”Ÿäº§ç¯å¢ƒ**çš„ä»£ç è´¨é‡å’Œå®‰å…¨æ ‡å‡†ï¼ğŸš€
