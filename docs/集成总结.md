# Spring Cloud ç»„ä»¶é›†æˆå®Œæˆæ€»ç»“

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ ¸å¿ƒç»„ä»¶é›†æˆ

#### ğŸ” é“¾è·¯è¿½è¸ªï¼ˆSleuth + Zipkinï¼‰
- âœ… åœ¨çˆ¶POMä¸­æ·»åŠ Sleuthå’ŒZipkinä¾èµ–
- âœ… ä¸ºæ‰€æœ‰å¾®æœåŠ¡æ·»åŠ é“¾è·¯è¿½è¸ªä¾èµ–
- âœ… é…ç½®ZipkinæœåŠ¡å™¨åœ°å€ï¼ˆæœ¬åœ°å’ŒDockerç¯å¢ƒï¼‰
- âœ… è®¾ç½®é‡‡æ ·ç‡ä¸º100%ï¼ˆå¼€å‘ç¯å¢ƒï¼‰
- âœ… åœ¨docker-compose.ymlä¸­æ·»åŠ ZipkinæœåŠ¡

**è®¿é—®åœ°å€**: http://localhost:9411

#### ğŸ“Š Spring Boot Admin
- âœ… åˆ›å»ºstock-admin-serverç›‘æ§æœåŠ¡æ¨¡å—
- âœ… é…ç½®Admin Serverå’Œå®‰å…¨è®¤è¯
- âœ… ä¸ºæ‰€æœ‰å¾®æœåŠ¡æ·»åŠ Admin Clientä¾èµ–
- âœ… é…ç½®Admin Clientè¿æ¥ä¿¡æ¯
- âœ… æš´éœ²æ‰€æœ‰Actuatorç«¯ç‚¹ä¾›ç›‘æ§
- âœ… åœ¨docker-compose.ymlä¸­æ·»åŠ Admin ServeræœåŠ¡

**è®¿é—®åœ°å€**: http://localhost:8090  
**ç™»å½•è´¦å·**: admin / admin123

#### ğŸ”„ Seata åˆ†å¸ƒå¼äº‹åŠ¡
- âœ… åœ¨çˆ¶POMä¸­æ·»åŠ Seataä¾èµ–
- âœ… ä¸ºstock-investment-serviceæ·»åŠ Seataä¾èµ–
- âœ… æä¾›åˆ†å¸ƒå¼äº‹åŠ¡ä½¿ç”¨ç¤ºä¾‹

**ä½¿ç”¨æ–¹å¼**: åœ¨éœ€è¦åˆ†å¸ƒå¼äº‹åŠ¡çš„æ–¹æ³•ä¸Šæ·»åŠ  `@GlobalTransactional` æ³¨è§£

#### ğŸ” Jasypt é…ç½®åŠ å¯†
- âœ… åœ¨çˆ¶POMä¸­æ·»åŠ Jasyptä¾èµ–
- âœ… ä¸ºæ‰€æœ‰å¾®æœåŠ¡æ·»åŠ Jasyptä¾èµ–
- âœ… æä¾›é…ç½®åŠ å¯†ä½¿ç”¨è¯´æ˜

**ä½¿ç”¨æ–¹å¼**: é…ç½®æ–‡ä»¶ä¸­ä½¿ç”¨ `ENC(åŠ å¯†åçš„å¯†ç )` æ ¼å¼

### 2. é…ç½®æ–‡ä»¶æ›´æ–°

#### âœ… å·²å®Œæˆé…ç½®çš„æœåŠ¡
- stock-auth-service (application.yml + application-docker.yml)
- stock-data-service (application.yml)
- stock-investment-service (application.yml)
- stock-correlation-service (application.yml)
- stock-gateway (application.yml)

#### ğŸ“ é…ç½®å†…å®¹
æ¯ä¸ªæœåŠ¡éƒ½æ·»åŠ äº†ï¼š
```yaml
spring:
  zipkin:
    base-url: http://localhost:9411  # æˆ– http://zipkin:9411 (Docker)
  sleuth:
    sampler:
      probability: 1.0
  boot:
    admin:
      client:
        url: http://localhost:8090  # æˆ–æœåŠ¡å (Docker)

management:
  endpoints:
    web:
      exposure:
        include: '*'
```

### 3. Docker Compose æ›´æ–°

âœ… æ·»åŠ äº†ä»¥ä¸‹æœåŠ¡ï¼š
- **zipkin**: é“¾è·¯è¿½è¸ªæœåŠ¡ (ç«¯å£9411)
- **stock-admin-server**: ç›‘æ§æœåŠ¡ (ç«¯å£8090)

### 4. æ–‡æ¡£å®Œå–„

âœ… åˆ›å»ºçš„æ–‡æ¡£ï¼š
- **SPRING-CLOUD-COMPONENTS.md**: è¯¦ç»†çš„ç»„ä»¶é›†æˆæŒ‡å—
  - ç»„ä»¶åŠŸèƒ½è¯´æ˜
  - å¿«é€Ÿå¯åŠ¨æŒ‡å—
  - é…ç½®è¯´æ˜
  - ä½¿ç”¨ç¤ºä¾‹
  - æ•…éšœæ’æŸ¥
  - æœ€ä½³å®è·µ

âœ… æ›´æ–°çš„æ–‡æ¡£ï¼š
- **README.md**: æ·»åŠ æ–°ç»„ä»¶è¯´æ˜å’Œè®¿é—®åœ°å€

### 5. è¾…åŠ©è„šæœ¬

âœ… å½“å‰è„šæœ¬ï¼š
- **scripts/backup-mysql.sh**: MySQLå…¨é‡å¤‡ä»½è„šæœ¬
- **scripts/deploy-technical-components.sh**: æŠ€æœ¯ç»„ä»¶ä¸€é”®éƒ¨ç½²è„šæœ¬
- **scripts/deploy.sh**: å…¨é‡éƒ¨ç½²è„šæœ¬
- **scripts/init-db-users.sh**: åˆå§‹åŒ–æ•°æ®åº“ç”¨æˆ·è„šæœ¬
- **scripts/rabbitmq-join-cluster.sh**: RabbitMQé›†ç¾¤åŠ å…¥è„šæœ¬
- **scripts/restore-mysql.sh**: MySQLæ¢å¤è„šæœ¬

---

## ğŸ“‹ å¾…å®Œå–„çš„é…ç½®

ä»¥ä¸‹æœåŠ¡çš„Dockeré…ç½®æ–‡ä»¶éœ€è¦æ‰‹åŠ¨æ·»åŠ é“¾è·¯è¿½è¸ªå’ŒAdmin Clienté…ç½®ï¼š

### éœ€è¦æ›´æ–°çš„æ–‡ä»¶

1. **stock-data-service/src/main/resources/application-docker.yml**
2. **stock-investment-service/src/main/resources/application-docker.yml**
3. **stock-correlation-service/src/main/resources/application-docker.yml**
4. **stock-gateway/src/main/resources/application-docker.yml**

### é…ç½®æ¨¡æ¿

åœ¨æ¯ä¸ª `application-docker.yml` ä¸­æ·»åŠ ï¼š

```yaml
spring:
  # Zipkiné“¾è·¯è¿½è¸ªé…ç½®ï¼ˆDockerç¯å¢ƒï¼‰
  zipkin:
    base-url: http://zipkin:9411
    sender:
      type: web
  sleuth:
    sampler:
      probability: 1.0

  # Spring Boot Admin Clienté…ç½®ï¼ˆDockerç¯å¢ƒï¼‰
  boot:
    admin:
      client:
        url: http://stock-admin-server:8090
        instance:
          prefer-ip: true
          service-base-url: http://${spring.application.name}:${server.port}

management:
  endpoints:
    web:
      exposure:
        include: '*'
```

---

## ğŸš€ å¿«é€ŸéªŒè¯

### 1. å¯åŠ¨æ‰€æœ‰æœåŠ¡

```bash
# æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps
```

### 2. éªŒè¯é“¾è·¯è¿½è¸ª

```bash
# è®¿é—®Zipkinç•Œé¢
open http://localhost:9411

# å‘èµ·ä¸€äº›APIè¯·æ±‚
curl http://localhost:8080/api/auth/login

# åœ¨Zipkinä¸­æŸ¥çœ‹è°ƒç”¨é“¾è·¯
```

### 3. éªŒè¯ç›‘æ§æœåŠ¡

```bash
# è®¿é—®Adminç›‘æ§ç•Œé¢
open http://localhost:8090

# ä½¿ç”¨ admin/admin123 ç™»å½•
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡çš„å¥åº·çŠ¶æ€
```

### 4. æŸ¥çœ‹æœåŠ¡æ³¨å†Œ

```bash
# è®¿é—®Nacosæ§åˆ¶å°
open http://localhost:8848/nacos

# ä½¿ç”¨ nacos/nacos ç™»å½•
# ç¡®è®¤æ‰€æœ‰æœåŠ¡éƒ½å·²æ³¨å†Œ
```

---

## ğŸ“Š é›†æˆæ•ˆæœ

### æœåŠ¡æ¶æ„å›¾

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   Frontend      â”‚
                    â”‚   (Port 80)     â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  API Gateway    â”‚
                    â”‚  (Port 8080)    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚                    â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
   â”‚  Auth    â”‚      â”‚    Data     â”‚      â”‚ Investment â”‚
   â”‚ Service  â”‚      â”‚   Service   â”‚      â”‚  Service   â”‚
   â”‚ (8081)   â”‚      â”‚   (8082)    â”‚      â”‚  (8083)    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                    â”‚                    â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                    â”‚                    â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
   â”‚  Nacos   â”‚      â”‚   Zipkin    â”‚      â”‚   Admin    â”‚
   â”‚ (8848)   â”‚      â”‚   (9411)    â”‚      â”‚  Server    â”‚
   â”‚          â”‚      â”‚             â”‚      â”‚  (8090)    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”
   â”‚  MySQL   â”‚
   â”‚  Redis   â”‚
   â”‚ RabbitMQ â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ç›‘æ§èƒ½åŠ›

é€šè¿‡Spring Boot Adminå¯ä»¥ç›‘æ§ï¼š
- âœ… æœåŠ¡å¥åº·çŠ¶æ€
- âœ… JVMå†…å­˜ä½¿ç”¨æƒ…å†µ
- âœ… çº¿ç¨‹ä¿¡æ¯
- âœ… HTTPè¯·æ±‚è¿½è¸ª
- âœ… æ—¥å¿—è¾“å‡º
- âœ… ç¯å¢ƒå˜é‡
- âœ… Beanä¿¡æ¯

é€šè¿‡Zipkinå¯ä»¥è¿½è¸ªï¼š
- âœ… è¯·æ±‚å®Œæ•´è°ƒç”¨é“¾
- âœ… æ¯ä¸ªæœåŠ¡çš„å“åº”æ—¶é—´
- âœ… æœåŠ¡ä¾èµ–å…³ç³»
- âœ… æ€§èƒ½ç“¶é¢ˆå®šä½

---

## ğŸ¯ ä¸‹ä¸€æ­¥å»ºè®®

### 1. ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–

- [ ] è°ƒæ•´Zipkiné‡‡æ ·ç‡ä¸º10%ï¼ˆ`spring.sleuth.sampler.probability: 0.1`ï¼‰
- [ ] é…ç½®ZipkinæŒä¹…åŒ–å­˜å‚¨ï¼ˆMySQLæˆ–Elasticsearchï¼‰
- [ ] ä¸ºAdmin Serveré…ç½®é‚®ä»¶/é’‰é’‰å‘Šè­¦
- [ ] å¯ç”¨Seata Serverï¼ˆå¦‚éœ€åˆ†å¸ƒå¼äº‹åŠ¡ï¼‰
- [ ] ä½¿ç”¨JasyptåŠ å¯†æ‰€æœ‰æ•æ„Ÿé…ç½®

### 2. ç›‘æ§å‘Šè­¦

- [ ] é…ç½®Admin Serverå‘Šè­¦è§„åˆ™
- [ ] é›†æˆPrometheus + Grafana
- [ ] é…ç½®æ—¥å¿—èšåˆï¼ˆELKï¼‰
- [ ] è®¾ç½®æœåŠ¡å¥åº·æ£€æŸ¥å‘Šè­¦

### 3. æ€§èƒ½ä¼˜åŒ–

- [ ] åˆ†æZipkiné“¾è·¯æ•°æ®ï¼Œä¼˜åŒ–æ…¢æ¥å£
- [ ] æ ¹æ®Adminç›‘æ§æ•°æ®è°ƒæ•´JVMå‚æ•°
- [ ] ä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢
- [ ] é…ç½®åˆç†çš„è¿æ¥æ± å¤§å°

---

## ğŸ“š å‚è€ƒèµ„æ–™

### å®˜æ–¹æ–‡æ¡£
- [Spring Cloud Sleuth](https://spring.io/projects/spring-cloud-sleuth)
- [Zipkin](https://zipkin.io/)
- [Spring Boot Admin](https://codecentric.github.io/spring-boot-admin/)
- [Seata](https://seata.io/)
- [Jasypt](https://github.com/ulisesbocchio/jasypt-spring-boot)

### é¡¹ç›®æ–‡æ¡£
- [SPRING-CLOUD-COMPONENTS.md](./SPRING-CLOUD-COMPONENTS.md) - è¯¦ç»†ä½¿ç”¨æŒ‡å—
- [README.md](../README.md) - é¡¹ç›®æ€»è§ˆ

---

## âœ¨ æ€»ç»“

æœ¬æ¬¡é›†æˆä¸ºè‚¡ç¥¨æŠ•èµ„ç³»ç»Ÿæ·»åŠ äº†å®Œæ•´çš„å¾®æœåŠ¡ç›‘æ§å’Œè¿½è¸ªèƒ½åŠ›ï¼š

1. **é“¾è·¯è¿½è¸ª**: å¯ä»¥æ¸…æ™°çœ‹åˆ°æ¯ä¸ªè¯·æ±‚çš„å®Œæ•´è°ƒç”¨é“¾è·¯
2. **æœåŠ¡ç›‘æ§**: å®æ—¶ç›‘æ§æ‰€æœ‰å¾®æœåŠ¡çš„å¥åº·çŠ¶æ€å’Œæ€§èƒ½æŒ‡æ ‡
3. **åˆ†å¸ƒå¼äº‹åŠ¡**: æ”¯æŒè·¨æœåŠ¡çš„äº‹åŠ¡ä¸€è‡´æ€§ä¿è¯
4. **é…ç½®åŠ å¯†**: ä¿æŠ¤æ•æ„Ÿé…ç½®ä¿¡æ¯

è¿™äº›ç»„ä»¶çš„é›†æˆå¤§å¤§æå‡äº†ç³»ç»Ÿçš„å¯è§‚æµ‹æ€§å’Œå¯ç»´æŠ¤æ€§ï¼Œä¸ºç”Ÿäº§ç¯å¢ƒéƒ¨ç½²æ‰“ä¸‹äº†åšå®çš„åŸºç¡€ã€‚

---

**é›†æˆå®Œæˆæ—¶é—´**: 2026-02-06  
**é›†æˆç‰ˆæœ¬**: v2.1.0  
**çŠ¶æ€**: âœ… æ ¸å¿ƒåŠŸèƒ½å·²å®Œæˆï¼Œéƒ¨åˆ†Dockeré…ç½®å¾…å®Œå–„