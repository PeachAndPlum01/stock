# å¤©é—® - å¾®æœåŠ¡å¿«é€Ÿå¯åŠ¨æŒ‡å—

## ğŸ‰ é¡¹ç›®å·²å®Œæˆå¾®æœåŠ¡æ”¹é€ ï¼

æœ¬é¡¹ç›®å·²æˆåŠŸæ”¹é€ ä¸ºæ ‡å‡†çš„å¾®æœåŠ¡æ¶æ„ï¼ŒåŒ…å«5ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡æ¨¡å—ã€‚

## ğŸ“¦ æœåŠ¡åˆ—è¡¨

| æœåŠ¡åç§° | ç«¯å£ | çŠ¶æ€ | è¯´æ˜ |
|---------|------|------|------|
| stock-gateway | 8080 | âœ… å®Œæˆ | APIç½‘å…³ï¼Œç»Ÿä¸€å…¥å£ |
| stock-auth-service | 8081 | âœ… å®Œæˆ | è®¤è¯æœåŠ¡ï¼Œç”¨æˆ·ç™»å½•æ³¨å†Œ |
| stock-data-service | 8082 | âœ… å®Œæˆ | è‚¡ç¥¨æ•°æ®æœåŠ¡ï¼ŒTushareé›†æˆ |
| stock-investment-service | 8083 | âœ… å®Œæˆ | æŠ•èµ„ä¿¡æ¯æœåŠ¡ï¼Œè‚¡ç¥¨æŸ¥è¯¢ |
| stock-correlation-service | 8084 | âœ… å®Œæˆ | çœä»½å…³è”æœåŠ¡ï¼Œç›¸å…³åº¦åˆ†æ |

## ğŸš€ å¿«é€Ÿå¯åŠ¨ï¼ˆ3ç§æ–¹å¼ï¼‰

### æ–¹å¼1ï¼šDocker Compose ä¸€é”®å¯åŠ¨ï¼ˆæ¨èï¼‰

```bash
# 1. é…ç½®ç¯å¢ƒå˜é‡
cp .env.template .env
# ç¼–è¾‘.envæ–‡ä»¶ï¼Œè®¾ç½®TUSHARE_TOKEN

# 2. å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# 3. æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# 4. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f stock-gateway

# 5. åœæ­¢æœåŠ¡
docker-compose down
```

### æ–¹å¼2ï¼šMaven æœ¬åœ°å¯åŠ¨

```bash
# 1. å¯åŠ¨åŸºç¡€è®¾æ–½ï¼ˆMySQLã€Redisã€RabbitMQï¼‰
docker-compose up -d mysql redis rabbitmq

# 2. ç­‰å¾…æ•°æ®åº“åˆå§‹åŒ–å®Œæˆï¼ˆçº¦30ç§’ï¼‰
sleep 30

# 3. ç¼–è¯‘é¡¹ç›®
mvn clean package -DskipTests

# 4. å¯åŠ¨å„ä¸ªæœåŠ¡ï¼ˆæŒ‰é¡ºåºï¼‰
# ç»ˆç«¯1 - å¯åŠ¨ç½‘å…³
cd stock-gateway
mvn spring-boot:run

# ç»ˆç«¯2 - å¯åŠ¨è®¤è¯æœåŠ¡
cd stock-auth-service
mvn spring-boot:run

# ç»ˆç«¯3 - å¯åŠ¨è‚¡ç¥¨æ•°æ®æœåŠ¡
cd stock-data-service
mvn spring-boot:run

# ç»ˆç«¯4 - å¯åŠ¨æŠ•èµ„ä¿¡æ¯æœåŠ¡
cd stock-investment-service
mvn spring-boot:run

# ç»ˆç«¯5 - å¯åŠ¨çœä»½å…³è”æœåŠ¡
cd stock-correlation-service
mvn spring-boot:run
```

### æ–¹å¼3ï¼šä½¿ç”¨å¯åŠ¨è„šæœ¬

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
./start-all.sh

# åœæ­¢æ‰€æœ‰æœåŠ¡
./stop-all.sh
```

## ğŸ” éªŒè¯æœåŠ¡æ˜¯å¦å¯åŠ¨æˆåŠŸ

### 1. æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€

```bash
# ç½‘å…³
curl http://localhost:8080/actuator/health

# è®¤è¯æœåŠ¡
curl http://localhost:8081/actuator/health

# è‚¡ç¥¨æ•°æ®æœåŠ¡
curl http://localhost:8082/actuator/health

# æŠ•èµ„ä¿¡æ¯æœåŠ¡
curl http://localhost:8083/actuator/health

# çœä»½å…³è”æœåŠ¡
curl http://localhost:8084/actuator/health
```

### 2. æµ‹è¯•ç™»å½•æ¥å£

```bash
curl -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "password": "123456"
  }'
```

æˆåŠŸå“åº”ç¤ºä¾‹ï¼š
```json
{
  "code": 200,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiJ9...",
    "userId": 1,
    "username": "admin",
    "nickname": "ç®¡ç†å‘˜"
  }
}
```

### 3. æµ‹è¯•è‚¡ç¥¨æŸ¥è¯¢æ¥å£ï¼ˆéœ€è¦Tokenï¼‰

```bash
# å…ˆç™»å½•è·å–token
TOKEN=$(curl -s -X POST http://localhost:8080/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"username":"admin","password":"123456"}' \
  | jq -r '.data.token')

# æŸ¥è¯¢è‚¡ç¥¨åˆ—è¡¨
curl -X GET "http://localhost:8080/api/investment/list?page=1&size=10" \
  -H "Authorization: Bearer $TOKEN"

# æŸ¥è¯¢æ¶¨å¹…æ¦œ
curl -X GET "http://localhost:8080/api/investment/top/gainers?limit=5" \
  -H "Authorization: Bearer $TOKEN"

# æŸ¥è¯¢çœä»½ç»Ÿè®¡
curl -X GET "http://localhost:8080/api/investment/stats/province" \
  -H "Authorization: Bearer $TOKEN"
```

## ğŸ“Š APIæ¥å£æ–‡æ¡£

### è®¤è¯æœåŠ¡ API

#### 1. ç”¨æˆ·ç™»å½•
```http
POST /api/auth/login
Content-Type: application/json

{
  "username": "admin",
  "password": "123456"
}
```

#### 2. ç”¨æˆ·æ³¨å†Œ
```http
POST /api/auth/register
Content-Type: application/json

{
  "username": "newuser",
  "password": "123456",
  "nickname": "æ–°ç”¨æˆ·",
  "email": "user@example.com"
}
```

#### 3. è·å–ç”¨æˆ·ä¿¡æ¯
```http
GET /api/auth/userinfo
Authorization: Bearer {token}
```

#### 4. ç”¨æˆ·ç™»å‡º
```http
POST /api/auth/logout
Authorization: Bearer {token}
```

### æŠ•èµ„ä¿¡æ¯æœåŠ¡ API

#### 1. åˆ†é¡µæŸ¥è¯¢è‚¡ç¥¨åˆ—è¡¨
```http
GET /api/investment/list?page=1&size=20&province=äº¬&keyword=äººå·¥æ™ºèƒ½&sortBy=tenDayChange&sortOrder=desc
Authorization: Bearer {token}
```

#### 2. è·å–è‚¡ç¥¨è¯¦æƒ…
```http
GET /api/investment/{id}
Authorization: Bearer {token}
```

#### 3. è·å–æ¶¨å¹…æ¦œ
```http
GET /api/investment/top/gainers?limit=10&province=äº¬
Authorization: Bearer {token}
```

#### 4. æŒ‰çœä»½ç»Ÿè®¡
```http
GET /api/investment/stats/province
Authorization: Bearer {token}
```

#### 5. æŒ‰æ¶¨å¹…èŒƒå›´æŸ¥è¯¢
```http
GET /api/investment/range?minChange=10&maxChange=20
Authorization: Bearer {token}
```

#### 6. æŒ‰é¢˜ææŸ¥è¯¢
```http
GET /api/investment/theme/äººå·¥æ™ºèƒ½
Authorization: Bearer {token}
```

#### 7. è·å–æ‰€æœ‰çœä»½
```http
GET /api/investment/provinces
Authorization: Bearer {token}
```

### çœä»½å…³è”æœåŠ¡ API

#### 1. è·å–æŒ‡å®šçœä»½çš„ç›¸å…³çœä»½
```http
GET /api/correlation/province/äº¬
Authorization: Bearer {token}
```

#### 2. è·å–ä¸¤ä¸ªçœä»½ä¹‹é—´çš„ç›¸å…³åº¦
```http
GET /api/correlation/between?source=äº¬&target=æ²ª
Authorization: Bearer {token}
```

#### 3. è·å–ç›¸å…³åº¦æœ€é«˜çš„çœä»½å¯¹
```http
GET /api/correlation/top?limit=10
Authorization: Bearer {token}
```

#### 4. æŒ‰ç›¸å…³åº¦èŒƒå›´æŸ¥è¯¢
```http
GET /api/correlation/range?minScore=0.5&maxScore=1.0
Authorization: Bearer {token}
```

#### 5. æŒ‰å…±åŒæ¦‚å¿µæŸ¥è¯¢
```http
GET /api/correlation/concept/äººå·¥æ™ºèƒ½
Authorization: Bearer {token}
```

### è‚¡ç¥¨æ•°æ®æœåŠ¡ API

#### 1. è·å–å®æ—¶è¡Œæƒ…
```http
GET /api/stock/realtime/quote?symbol=688981.SH
Authorization: Bearer {token}
```

#### 2. å¯åŠ¨å®æ—¶æ¨é€
```http
POST /api/stock/realtime/start
Authorization: Bearer {token}
```

#### 3. åœæ­¢å®æ—¶æ¨é€
```http
POST /api/stock/realtime/stop
Authorization: Bearer {token}
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡é…ç½®ï¼ˆ.envæ–‡ä»¶ï¼‰

```bash
# Tushare API Tokenï¼ˆå¿…é¡»é…ç½®ï¼‰
TUSHARE_TOKEN=your_tushare_token_here

# MySQLé…ç½®
MYSQL_ROOT_PASSWORD=root
MYSQL_DATABASE=stock_investment

# Redisé…ç½®
REDIS_PASSWORD=

# RabbitMQé…ç½®
RABBITMQ_DEFAULT_USER=guest
RABBITMQ_DEFAULT_PASS=guest

# JWTé…ç½®
JWT_SECRET=stock-investment-system-jwt-secret-key-2024
JWT_EXPIRATION=86400000
```

### ç«¯å£é…ç½®

| æœåŠ¡ | ç«¯å£ | è¯´æ˜ |
|------|------|------|
| APIç½‘å…³ | 8080 | ç»Ÿä¸€å…¥å£ |
| è®¤è¯æœåŠ¡ | 8081 | ç”¨æˆ·è®¤è¯ |
| è‚¡ç¥¨æ•°æ®æœåŠ¡ | 8082 | Tushareæ•°æ® |
| æŠ•èµ„ä¿¡æ¯æœåŠ¡ | 8083 | è‚¡ç¥¨æŸ¥è¯¢ |
| çœä»½å…³è”æœåŠ¡ | 8084 | ç›¸å…³åº¦åˆ†æ |
| MySQL | 3306 | æ•°æ®åº“ |
| Redis | 6379 | ç¼“å­˜ |
| RabbitMQ | 5672 | æ¶ˆæ¯é˜Ÿåˆ— |
| RabbitMQç®¡ç†ç•Œé¢ | 15672 | Webç®¡ç† |

## ğŸ“ é¡¹ç›®ç»“æ„

```
stock/
â”œâ”€â”€ pom.xml                          # çˆ¶POM
â”œâ”€â”€ docker-compose.yml               # Dockerç¼–æ’
â”œâ”€â”€ .env.template                    # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ start-all.sh                     # å¯åŠ¨è„šæœ¬
â”œâ”€â”€ stop-all.sh                      # åœæ­¢è„šæœ¬
â”œâ”€â”€ sql/
â”‚   â””â”€â”€ init.sql                     # æ•°æ®åº“åˆå§‹åŒ–
â”œâ”€â”€ frontend/                        # å‰ç«¯é¡¹ç›®
â”œâ”€â”€ stock-gateway/                   # âœ… APIç½‘å…³
â”œâ”€â”€ stock-auth-service/              # âœ… è®¤è¯æœåŠ¡
â”œâ”€â”€ stock-data-service/              # âœ… è‚¡ç¥¨æ•°æ®æœåŠ¡
â”œâ”€â”€ stock-investment-service/        # âœ… æŠ•èµ„ä¿¡æ¯æœåŠ¡
â””â”€â”€ stock-correlation-service/       # âœ… çœä»½å…³è”æœåŠ¡
```

## ğŸ› å¸¸è§é—®é¢˜

### 1. æœåŠ¡å¯åŠ¨å¤±è´¥

**é—®é¢˜**ï¼šæœåŠ¡å¯åŠ¨æ—¶æŠ¥é”™è¿æ¥æ•°æ®åº“å¤±è´¥

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥MySQLæ˜¯å¦å¯åŠ¨
docker-compose ps mysql

# æŸ¥çœ‹MySQLæ—¥å¿—
docker-compose logs mysql

# ç­‰å¾…MySQLå®Œå…¨å¯åŠ¨ï¼ˆçº¦30ç§’ï¼‰
sleep 30
```

### 2. TokenéªŒè¯å¤±è´¥

**é—®é¢˜**ï¼šè¯·æ±‚APIæ—¶è¿”å›401 Unauthorized

**è§£å†³**ï¼š
- æ£€æŸ¥Tokenæ˜¯å¦æ­£ç¡®
- æ£€æŸ¥Tokenæ˜¯å¦è¿‡æœŸï¼ˆé»˜è®¤24å°æ—¶ï¼‰
- ç¡®ä¿è¯·æ±‚å¤´æ ¼å¼æ­£ç¡®ï¼š`Authorization: Bearer {token}`

### 3. ç«¯å£å†²çª

**é—®é¢˜**ï¼šæœåŠ¡å¯åŠ¨æ—¶æŠ¥é”™ç«¯å£å·²è¢«å ç”¨

**è§£å†³**ï¼š
```bash
# æŸ¥çœ‹ç«¯å£å ç”¨
lsof -i :8080

# ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„ç«¯å£
vim stock-gateway/src/main/resources/application.yml
```

### 4. Tushare APIè°ƒç”¨å¤±è´¥

**é—®é¢˜**ï¼šè‚¡ç¥¨æ•°æ®æœåŠ¡æ— æ³•è·å–æ•°æ®

**è§£å†³**ï¼š
- æ£€æŸ¥TUSHARE_TOKENæ˜¯å¦é…ç½®æ­£ç¡®
- ç¡®è®¤Tushareè´¦å·æ˜¯å¦æœ‰æƒé™
- æ£€æŸ¥ç½‘ç»œè¿æ¥

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [å¾®æœåŠ¡æ¶æ„è¯´æ˜](./ å¾®æœåŠ¡æ¶æ„è¯´æ˜.md) - å¾®æœåŠ¡æ¶æ„è¯¦ç»†è¯´æ˜
- [å¾®æœåŠ¡æ”¹é€ å®ŒæˆæŠ¥å‘Š](./ å¾®æœåŠ¡æ”¹é€ å®ŒæˆæŠ¥å‘Š.md) - æ”¹é€ å®ŒæˆæŠ¥å‘Š
- [APIæ¥å£æ–‡æ¡£](./APIæ¥å£æ–‡æ¡£.md) - å®Œæ•´APIæ–‡æ¡£
- [éƒ¨ç½²æ–‡æ¡£](./ éƒ¨ç½²æ–‡æ¡£.md) - éƒ¨ç½²æ–‡æ¡£

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **å‰ç«¯é›†æˆ**ï¼šä¿®æ”¹å‰ç«¯APIåŸºç¡€åœ°å€ä¸ºç½‘å…³åœ°å€ï¼ˆhttp://localhost:8080ï¼‰
2. **æœåŠ¡å‘ç°**ï¼šé›†æˆNacoså®ç°æœåŠ¡è‡ªåŠ¨æ³¨å†Œä¸å‘ç°
3. **é…ç½®ä¸­å¿ƒ**ï¼šä½¿ç”¨Nacos Configç»Ÿä¸€ç®¡ç†é…ç½®
4. **ç›‘æ§å‘Šè­¦**ï¼šé›†æˆPrometheus + Grafana
5. **é“¾è·¯è¿½è¸ª**ï¼šé›†æˆSleuth + Zipkin

## ğŸ’¡ æŠ€æœ¯æ ˆ

- **æ¡†æ¶**ï¼šSpring Boot 2.7.18ã€Spring Cloud 2021.0.8
- **ç½‘å…³**ï¼šSpring Cloud Gateway
- **æ•°æ®åº“**ï¼šMySQL 8.0ã€MyBatis Plus 3.5.4
- **ç¼“å­˜**ï¼šRedis 7.0
- **æ¶ˆæ¯é˜Ÿåˆ—**ï¼šRabbitMQ 3.12
- **è®¤è¯**ï¼šJWT (jjwt 0.11.5)
- **å®¹å™¨åŒ–**ï¼šDockerã€Docker Compose

## ğŸ“ æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
1. æœåŠ¡æ—¥å¿—ï¼š`docker-compose logs -f {service-name}`
2. å¥åº·æ£€æŸ¥ï¼š`curl http://localhost:{port}/actuator/health`
3. é¡¹ç›®æ–‡æ¡£ï¼šæŸ¥çœ‹docsç›®å½•

---

**é¡¹ç›®ç‰ˆæœ¬**ï¼š1.0.0  
**æœ€åæ›´æ–°**ï¼š2026-02-01  
**å¾®æœåŠ¡æ”¹é€ **ï¼šâœ… å·²å®Œæˆ
