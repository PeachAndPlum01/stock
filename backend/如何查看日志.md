# 📖 如何查看日志

## 🚀 启动应用

```bash
cd backend
mvn spring-boot:run
```

启动后，`logs` 目录会自动创建，日志开始记录。

---

## 📁 日志文件位置

所有日志都在：`backend/logs/` 目录

```
backend/logs/
├── all.log      # 所有日志（推荐日常查看）
├── error.log    # 只有错误日志（出问题时看这个）
├── warn.log     # 警告日志
├── info.log     # 一般信息日志
└── debug.log    # 调试日志（开发时看这个）
```

---

## 📋 查看日志的方法

### 方法1：使用交互式脚本（最简单）⭐⭐⭐

```bash
cd backend
./view-logs.sh
```

运行后会看到菜单，选择对应的选项即可：
- 选项 1：实时查看所有日志
- 选项 2：实时查看错误日志
- 选项 5：搜索日志内容
- 选项 6：查看日志统计

### 方法2：直接使用命令

#### 实时查看日志（最常用）

```bash
# 实时查看所有日志
tail -f backend/logs/all.log

# 实时查看错误日志
tail -f backend/logs/error.log

# 实时查看最近100行
tail -n 100 -f backend/logs/all.log
```

**提示**：按 `Ctrl + C` 停止查看

#### 查看历史日志

```bash
# 查看最后50行
tail -n 50 backend/logs/all.log

# 查看最后100行
tail -n 100 backend/logs/error.log

# 查看文件开头
head -n 50 backend/logs/all.log

# 查看完整文件
cat backend/logs/all.log
```

#### 搜索日志

```bash
# 搜索包含"exception"的日志
grep "exception" backend/logs/all.log

# 搜索包含"ERROR"的日志
grep "ERROR" backend/logs/all.log

# 搜索并显示前后3行（查看上下文）
grep -C 3 "exception" backend/logs/error.log

# 搜索并高亮显示
grep --color "ERROR" backend/logs/all.log

# 搜索多个关键词
grep -E "ERROR|exception|failed" backend/logs/all.log

# 不区分大小写搜索
grep -i "error" backend/logs/all.log
```

#### 按时间查看日志

```bash
# 查看今天的日志
grep "2026-01-30" backend/logs/all.log

# 查看某个时间段的日志
grep "2026-01-30 14:" backend/logs/all.log
```

#### 统计日志

```bash
# 统计错误日志数量
grep -c "ERROR" backend/logs/all.log

# 统计各级别日志数量
echo "ERROR: $(grep -c 'ERROR' backend/logs/all.log)"
echo "WARN:  $(grep -c 'WARN' backend/logs/all.log)"
echo "INFO:  $(grep -c 'INFO' backend/logs/all.log)"

# 查看日志文件大小
ls -lh backend/logs/
```

---

## 🎯 实际使用场景

### 场景1：应用启动后，查看是否正常运行

```bash
# 实时查看所有日志
tail -f backend/logs/all.log

# 或者只看错误
tail -f backend/logs/error.log
```

### 场景2：用户报告问题，排查错误

```bash
# 查看最近的错误日志
tail -n 100 backend/logs/error.log

# 搜索异常
grep "exception" backend/logs/error.log

# 搜索特定用户的操作
grep "username=张三" backend/logs/all.log
```

### 场景3：监控系统运行状态

```bash
# 统计各级别日志数量
echo "=== 日志统计 ==="
echo "ERROR: $(grep -c 'ERROR' backend/logs/all.log)"
echo "WARN:  $(grep -c 'WARN' backend/logs/all.log)"
echo "INFO:  $(grep -c 'INFO' backend/logs/all.log)"

# 查看日志文件大小
ls -lh backend/logs/

# 查看最近的错误
tail -n 20 backend/logs/error.log
```

### 场景4：开发调试

```bash
# 实时查看所有日志，过滤出API相关的
tail -f backend/logs/all.log | grep "Controller"

# 查看某个接口的调用日志
grep "/api/investment" backend/logs/all.log
```

---

## 💡 实用技巧

### 技巧1：多窗口同时查看

```bash
# 终端1：运行应用
cd backend && mvn spring-boot:run

# 终端2：查看所有日志
tail -f backend/logs/all.log

# 终端3：查看错误日志
tail -f backend/logs/error.log
```

### 技巧2：日志导出

```bash
# 导出今天的错误日志
grep "2026-01-30" backend/logs/error.log > today_errors.txt

# 导出某个用户的操作日志
grep "username=admin" backend/logs/all.log > admin_logs.txt

# 导出搜索结果
grep "exception" backend/logs/all.log > exceptions.txt
```

### 技巧3：使用别名（快捷命令）

在 `~/.bashrc` 或 `~/.zshrc` 中添加：

```bash
# 日志查看别名
alias log-all='tail -f backend/logs/all.log'
alias log-error='tail -f backend/logs/error.log'
alias log-search='grep -i --color'
alias log-stats='echo "ERROR: $(grep -c ERROR backend/logs/all.log) | WARN: $(grep -c WARN backend/logs/all.log) | INFO: $(grep -c INFO backend/logs/all.log)"'
```

然后就可以直接使用：
```bash
log-all        # 查看所有日志
log-error      # 查看错误日志
log-search "exception" backend/logs/all.log  # 搜索日志
log-stats      # 查看统计
```

---

## 🔍 日志格式说明

```
2026-01-30 14:15:28.123 [http-nio-8080-exec-1] INFO  com.stock.controller.AuthController - 用户登录成功: username=admin
```

- `2026-01-30 14:15:28.123` - 时间戳（精确到毫秒）
- `[http-nio-8080-exec-1]` - 线程名
- `INFO` - 日志级别（DEBUG、INFO、WARN、ERROR）
- `com.stock.controller.AuthController` - 类名
- `用户登录成功: username=admin` - 日志消息

---

## ⚠️ 注意事项

1. **首次启动**：logs 目录会自动创建，不需要手动创建
2. **实时查看**：使用 `tail -f` 可以实时看到新产生的日志
3. **搜索技巧**：使用 `grep` 可以快速定位问题
4. **文件大小**：日志文件会自动滚动，单个文件最大10MB。历史日志会按日期归档，可以手动删除旧的归档文件。
5. **权限问题**：确保有读取 logs 目录的权限

---

## 🆘 常见问题

**Q：logs 目录不存在？**  
A：需要先启动应用，目录会自动创建。

**Q：看不到日志？**  
A：检查应用是否正常启动，查看控制台是否有错误。

**Q：日志文件太大？**  
A：系统会自动滚动，单个文件最大10MB。历史日志会按日期归档，可以手动删除旧的归档文件。

**Q：如何只看某个时间段的日志？**  
A：使用 grep 过滤时间：`grep "2026-01-30 14:" backend/logs/all.log`

**Q：如何在 Windows 上查看？**  
A：
- 使用 Git Bash 或 WSL 执行上述命令
- 或者直接用文本编辑器（如 Notepad++、VS Code）打开日志文件

---

## 🚀 快速开始

```bash
# 1. 启动应用
cd backend
mvn spring-boot:run

# 2. 新开一个终端，实时查看日志
tail -f backend/logs/all.log

# 3. 或者使用交互式脚本
./view-logs.sh
```

🎉 现在你可以轻松查看日志了！

---

## 📚 更多信息

- 日志配置说明：[LOGGING.md](LOGGING.md)
- 完整系统总结：[../LOG_SYSTEM_SUMMARY.md](../LOG_SYSTEM_SUMMARY.md)
