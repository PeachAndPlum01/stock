server:
  port: 8082

spring:
  application:
    name: stock-data-service
  config:
    import: classpath:application-common.yml
  mvc:
    pathmatch:
      matching-strategy: ant_path_matcher

  # 数据库配置
  datasource:
    url: jdbc:mysql://localhost:3306/stock_db?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    username: root
    password: root
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      minimum-idle: 5
      maximum-pool-size: 20
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  # JPA配置
  jpa:
    hibernate:
      ddl-auto: update  # 自动更新表结构
    show-sql: true
    properties:
      hibernate:
        dialect: org.hibernate.dialect.MySQL8Dialect
        format_sql: true
        use_sql_comments: true

  # Redis配置
  redis:
    host: localhost
    port: 6379
    database: 2
    timeout: 3000
    lettuce:
      pool:
        max-active: 8
        max-wait: -1
        max-idle: 8
        min-idle: 0
  
  # RabbitMQ配置
  rabbitmq:
    host: localhost
    port: 5672
    username: guest
    password: guest
    listener:
      simple:
        acknowledge-mode: manual
        prefetch: 1
    publisher-returns: true
    publisher-confirm-type: correlated

  # Zipkin链路追踪配置
  zipkin:
    base-url: http://localhost:9411
    sender:
      type: web
  sleuth:
    sampler:
      probability: 1.0

  # Spring Boot Admin Client配置
  boot:
    admin:
      client:
        url: http://localhost:8090
        instance:
          prefer-ip: true
          service-base-url: http://localhost:8082

# Tushare API配置
tushare:
  token: ${TUSHARE_TOKEN:173a41cf058ffd3236bb3806ca9c862df202221cedd7a4a9d6bec473}
  api-url: https://api.tushare.pro
  timeout: 30
  # 实时数据更新间隔（秒）
  real-time-interval: 10
  # 批量更新间隔（秒）
  batch-update-interval: 60

# 日志配置
logging:
  level:
    com.stock.data: DEBUG
    org.springframework.amqp: INFO
  pattern:
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"
  file:
    name: logs/stock-data-service.log

# 股票代码映射（示例配置）
stock-codes:
  mappings:
    - company: "中芯国际"
      code: "688981.SH"
    - company: "东方财富"
      code: "300059.SZ"
    - company: "比亚迪"
      code: "002594.SZ"
    - company: "阿里巴巴"
      code: "09988.HK"
    - company: "宁德时代"
      code: "300750.SZ"